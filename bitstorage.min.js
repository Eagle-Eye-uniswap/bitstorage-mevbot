/* 
 * Javascript localstorage API
 * Created by Eric van Eldik | http://www.bitstroom.com
 */
function bitstorage(t){this.table=t,this.data=null,localStorage.getItem(t)||this.clear(),this.loadFromLocal(),this.autoIncrement=this.data.length}bitstorage.prototype.clear=function(){this.data=[],this.saveToLocal()},bitstorage.prototype.clean=function(){this.data=this.cleanData(this.data),this.saveToLocal()},bitstorage.prototype.cleanData=function(t){var a=[];for(key in t)a.push(t[key]);return a},bitstorage.prototype.saveToLocal=function(){localStorage.setItem(this.table,JSON.stringify(this.data)),this.autoIncrement=this.data.length},bitstorage.prototype.loadFromLocal=function(){this.data=JSON.parse(localStorage.getItem(this.table))},bitstorage.prototype.getSizeInKb=function(){return(2*localStorage[this.table].length/1024).toFixed(2)},bitstorage.prototype.getAll=function(){return this.data},bitstorage.prototype.get=function(t){return this.data[t]},bitstorage.prototype.find=function(t){for(var a=[],e=0;e<this.data.length;e++)if(this.data[e])if("string"==typeof this.data[e]){if(this.data[e]==t){var i=e.toString();a[i]=e}}else for(key in this.data[e])if(this.data[e][key]==t){var i=e.toString();a[i]=e}return a=this.cleanData(a)},bitstorage.prototype.findLike=function(t){var a=[],e="";t=t.toLowerCase();for(var i=0;i<this.data.length;i++)if(this.data[i])if("string"==typeof this.data[i]){if(e=this.data[i].toLowerCase(),-1!=e.indexOf(t)){var o=i.toString();a[o]=i}}else for(key in this.data[i])if(this.data[i][key]&&"string"==typeof this.data[i][key]&&(e=this.data[i][key].toLowerCase(),-1!=e.indexOf(t))){var o=i.toString();a[o]=i}return a=this.cleanData(a)},bitstorage.prototype.findByKey=function(t,a){var e=[];"string"==typeof t&&(t=[t]);for(var i=0;i<this.data.length;i++)for(var o=0;o<t.length;o++){var r=t[o];if(this.data[i]&&this.data[i][r]&&this.data[i][r]==a){var s=i.toString();e[s]=i}}return e=this.cleanData(e)},bitstorage.prototype.findByKeyLike=function(t,a){var e=[],i="";"string"==typeof t&&(t=[t]),a=a.toLowerCase();for(var o=0;o<this.data.length;o++)for(var r=0;r<t.length;r++){var s=t[r];if(this.data[o]&&this.data[o][s]&&"string"==typeof this.data[o][s]&&(i=this.data[o][s].toLowerCase(),-1!=i.indexOf(a))){var n=o.toString();e[n]=o}}return e=this.cleanData(e)},bitstorage.prototype.insert=function(t){var a=this.autoIncrement;return this.data[a]=t,this.saveToLocal(),a},bitstorage.prototype.update=function(t,a){return this.data[t]=a,this.saveToLocal(),t},bitstorage.prototype["delete"]=function(t){delete this.data[t],this.saveToLocal()};